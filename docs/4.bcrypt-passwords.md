Of course. Now that it's working, creating clear documentation is the perfect next step.

This guide is written as a standalone document. Someone with the previous version of your project (with sessions but without hashing) can follow it to implement this critical security feature.

***

### **Project Documentation: Implementing Secure Password Hashing with `bcrypt`**

This document explains how to upgrade the application's security by replacing plain-text password storage with industry-standard hashing using the `bcrypt` library.

#### **1. What This Feature Is About (The "Why")**

**The Problem:** Our application currently stores user passwords in the `users.json` file exactly as they are typed. This is a major security vulnerability. If an attacker were to gain access to this file, they would have the exact credentials for every user.

**The Solution (Hashing):** We will implement password hashing. Hashing is a one-way process that transforms a password into a long, unique string of characters called a "hash." This process is irreversible, meaning the original password cannot be recovered from the hash.

*   **Plain-Text Password:** `my-secure-password`
*   **Resulting Hash:** `$2b$10$AbC.dEfG/hIjK/lMnOpQrStUvWxYz.1234567890aBcDe`

Instead of comparing passwords directly, we will compare the hash of the password a user enters with the hash we have stored.

#### **2. Tool We Will Use**

*   **`bcrypt`**: The industry-standard library for password hashing in Node.js. It is highly secure and deliberately slow, which makes it resistant to brute-force attacks where an attacker tries to guess passwords millions of times per second.

---

### **3. Step-by-Step Implementation Guide**

#### **Step 1: Install the `bcrypt` Package**

First, you need to add the package to your project. Stop your server if it's running (`Ctrl+C`) and run this command in your terminal:

```bash
npm install bcrypt
```

#### **Step 2: Update `server.js` with Hashing Logic**

We need to modify the server to perform hashing in three key places: user registration, user login, and when the admin updates a password.

Replace your entire `server.js` file with this complete, updated code. The changes are clearly marked with comments.

```javascript
const express = require('express');
const fs = require('fs');
const path = require('path');
const session = require('express-session');
const bcrypt = require('bcrypt'); // 1. IMPORT the bcrypt library
const app = express();
const port = 3000;

// ======================================================
// 1. TOP-LEVEL MIDDLEWARE
// ======================================================
app.use(express.json());

app.use(session({
    secret: 'a-super-secret-key-for-your-app',
    resave: false,
    saveUninitialized: false,
    cookie: { maxAge: 1000 * 60 * 60 }
}));

// ======================================================
// 2. API ROUTES
// ======================================================

// --- REGULAR USER API ROUTES (UPDATED) ---

// UPDATED: Register route now hashes the password
app.post('/register', async (req, res) => { // Use 'async' to allow 'await'
    const { username, password } = req.body;
    const usersFilePath = path.join(__dirname, 'users.json');
    fs.readFile(usersFilePath, 'utf8', async (err, data) => { // Use 'async' here too
        if (err && err.code !== 'ENOENT') return res.status(500).send('Error reading users file.');
        const users = data ? JSON.parse(data) : [];
        if (users.find(user => user.username === username)) return res.status(400).send('Username already exists.');
        
        // 2. HASH THE PASSWORD before saving it
        // The "10" is the salt rounds, a standard value that determines hash complexity.
        const hashedPassword = await bcrypt.hash(password, 10);

        // Save the HASHED password, not the original plain-text one.
        users.push({ username, password: hashedPassword });

        fs.writeFile(usersFilePath, JSON.stringify(users, null, 2), (err) => {
            if (err) return res.status(500).send('Error saving user.');
            res.status(200).send('User registered successfully.');
        });
    });
});

// UPDATED: Login route now compares the password with the stored hash
app.post('/login', async (req, res) => { // Use 'async'
    const { username, password } = req.body;
    const usersFilePath = path.join(__dirname, 'users.json');
    fs.readFile(usersFilePath, 'utf8', async (err, data) => { // Use 'async'
        if (err) return res.status(500).send('Error reading users file.');
        const users = JSON.parse(data);
        const user = users.find(u => u.username === username);

        // 3. SECURELY COMPARE the submitted password with the stored hash
        if (user && await bcrypt.compare(password, user.password)) {
            // If the user exists AND the password is correct, login is successful.
            res.status(200).send('Login successful.');
        } else {
            // Either the user was not found or the password was incorrect.
            res.status(400).send('Invalid username or password.');
        }
    });
});


// --- ADMIN API ROUTES (Partially Updated) ---

const ADMIN_USER = { username: 'admin', password: 'adminpassword' };
app.post('/admin/login', (req, res) => { /* ... (No changes) ... */ });
app.post('/admin/logout', (req, res) => { /* ... (No changes) ... */ });
function requireAdmin(req, res, next) { /* ... (No changes) ... */ }
app.get('/api/admin/status', (req, res) => { /* ... (No changes) ... */ });
app.get('/api/users', requireAdmin, (req, res) => { /* ... (No changes) ... */ });
app.delete('/api/users/:username', requireAdmin, (req, res) => { /* ... (No changes) ... */ });

// UPDATED: Admin password update now hashes the new password
app.put('/api/users/:username', requireAdmin, async (req, res) => { // Use 'async'
    const { username } = req.params;
    const { newPassword } = req.body;
    const usersFilePath = path.join(__dirname, 'users.json');
    fs.readFile(usersFilePath, 'utf8', async (err, data) => { // Use 'async'
        if (err) return res.status(500).send('Error reading users file.');
        let users = data ? JSON.parse(data) : [];
        const userToUpdate = users.find(user => user.username === username);
        if (!userToUpdate) return res.status(404).send('User not found.');

        // 4. HASH THE NEW PASSWORD before the admin saves it
        const hashedPassword = await bcrypt.hash(newPassword, 10);
        userToUpdate.password = hashedPassword;

        fs.writeFile(usersFilePath, JSON.stringify(users, null, 2), (err) => {
            if (err) return res.status(500).send('Error saving user data.');
            res.status(200).send(`Password for '${username}' updated successfully.`);
        });
    });
});

// ======================================================
// 3. PAGE SERVING & STATIC FILES
// ======================================================
app.get('/admin', (req, res) => { res.sendFile(path.join(__dirname, 'admin.html')); });
app.get('/', (req, res) => { res.sendFile(path.join(__dirname, 'index.html')); });
app.use(express.static(__dirname));

// ======================================================
// 4. SERVER INITIALIZATION
// ======================================================
app.listen(port, () => {
    console.log(`Server is running on http://localhost:${port}`);
    console.log(`Admin dashboard at http://localhost:${port}/admin`);
});
```

#### **Step 3: Reset Your User Database (CRITICAL STEP)**

Your existing `users.json` file contains plain-text passwords. The new login code, which expects hashes, will not work with them. You **must** clear this file to start fresh.

1.  Open your `users.json` file.
2.  Delete all of its content.
3.  Replace it with a single empty array: `[]`
4.  Save the file.

---

#### **4. How to Test and Verify the Feature**

1.  **Restart your server** by running `node server.js` in your terminal.
2.  Go to the main page (`http://localhost:3000`).
3.  **Register a new user.**
4.  **Verification:** Open the `users.json` file. You will see that the `password` field now contains a long string of characters. This is the bcrypt hash.
5.  **Test Login:** On the main page, try to log in with the user you just created. The login should succeed because `bcrypt.compare` is working correctly.
6.  **Test Admin Update:** Log in as an admin, change the password of your new user, and check `users.json` again. You will see the hash has changed to a new value.

You have now successfully secured your application's passwords, a crucial step in building a trustworthy and professional web application.